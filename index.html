<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>setTimeoutç¦æ­¢1ãƒ»ç‹¬ç«‹3ç§’é…å»¶ãƒ»é€£æ‰“åŒæ™‚é–‹æ”¾</title>
<style>
body { font-family: sans-serif; text-align: center; margin-top: 40px; }
button {
  padding: 10px 20px;
  font-size: 18px;
  margin: 10px;
  cursor: pointer;
  border-radius: 8px;
  border: none;
  background-color: #0078d7;
  color: white;
  transition: 0.2s;
}
button:hover { background-color: #005fa3; }
button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}
#status {
  margin-top: 20px;
  font-size: 16px;
  color: #333;
}
</style>
</head>
<body>
<h2>setTimeoutç¦æ­¢ãƒ»3ç§’é…å»¶ãƒ»é€£æ‰“åŒæ™‚ã‚ªãƒ¼ãƒ—ãƒ³</h2>
<button id="openBtn">URLã‚’é–‹ã</button>
<div id="status"></div>
<script>
const urls = [
  "https://open2ch.net/ajax/add_history.cgi?bbs=livejupiter&key=1761988917",
  "https://open2ch.net/ajax/add_history.cgi?bbs=livejupiter&key=1701197940"
];

let pendingClicks = [];
let isProcessing = false;

// requestAnimationFrameãƒ™ãƒ¼ã‚¹ã®é…å»¶é–¢æ•°
async function rafWait(ms) {
  const end = performance.now() + ms;
  return new Promise(resolve => {
    function tick() {
      if (performance.now() >= end) {
        resolve();
      } else {
        requestAnimationFrame(tick);
      }
    }
    requestAnimationFrame(tick);
  });
}

document.getElementById("openBtn").addEventListener("click", async function () {
  const btn = this;
  const statusDiv = document.getElementById("status");
  
  // ã‚¯ãƒªãƒƒã‚¯ã‚’è¨˜éŒ²
  const clickIndex = pendingClicks.length;
  const targetUrl = urls[clickIndex % urls.length];
  pendingClicks.push({ index: clickIndex + 1, url: targetUrl });
  
  console.log(`ğŸ•’ [${clickIndex + 1}] 3ç§’å¾…æ©Ÿé–‹å§‹`);
  statusDiv.textContent = `å¾…æ©Ÿä¸­: ${pendingClicks.length}å€‹ã®URL`;
  
  // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ã®å ´åˆã€å‡¦ç†ã‚’é–‹å§‹
  if (!isProcessing) {
    isProcessing = true;
    btn.disabled = true;
    
    // 3ç§’å¾…æ©Ÿ
    await rafWait(3000);
    
    // æºœã¾ã£ã¦ã„ã‚‹ã™ã¹ã¦ã®ã‚¯ãƒªãƒƒã‚¯ã‚’ä¸€æ°—ã«é–‹ã
    const clicksToOpen = [...pendingClicks];
    pendingClicks = [];
    
    console.log(`ğŸš€ ${clicksToOpen.length}å€‹ã®URLã‚’åŒæ™‚ã«é–‹ãã¾ã™`);
    clicksToOpen.forEach(click => {
      console.log(`ğŸš€ [${click.index}] é–‹ã: ${click.url}`);
      window.open(click.url, "_blank");
    });
    
    statusDiv.textContent = `${clicksToOpen.length}å€‹ã®URLã‚’é–‹ãã¾ã—ãŸ`;
    btn.disabled = false;
    isProcessing = false;
  }
});
</script>
</body>
</html>
